<input id="npm" placeholder="Masukkan NPM..." />
<div id="result"></div>

<script>
const input = document.getElementById('npm');
const result = document.getElementById('result');

input.addEventListener('input', async e => {
  const keyword = e.target.value.trim();
  if (keyword.length < 4) return (result.innerHTML = '');

  try {
    const res = await fetch(`https://api-pddikti.ridwaanhall.com/search/mhs/${keyword}`);
    const data = await res.json();

    if (data.length === 0) {
      result.innerHTML = '❌ Data tidak ditemukan.';
      return;
    }

    // Coba filter exact match dulu
    const exact = data.find(d => d.nim === keyword);
    if (exact) {
      result.innerHTML = `
        <b>${exact.nama}</b><br>
        NIM: ${exact.nim}<br>
        Prodi: ${exact.nama_prodi}<br>
        PT: ${exact.nama_pt}
      `;
      return;
    }

    // Kalau tidak ada exact match, tampilkan daftar
    result.innerHTML = `
      <p>⚠️ Ditemukan ${data.length} hasil, pilih salah satu:</p>
      <ul>
        ${data
          .map(
            d =>
              `<li onclick="selectData('${d.nim}', '${d.nama}', '${d.nama_prodi}', '${d.nama_pt}')">
                ${d.nim} — ${d.nama} (${d.nama_prodi})
              </li>`
          )
          .join('')}
      </ul>`;
  } catch (err) {
    result.innerHTML = '⚠️ Gagal memuat data.';
  }
});

function selectData(nim, nama, prodi, pt) {
  result.innerHTML = `
    <b>${nama}</b><br>
    NIM: ${nim}<br>
    Prodi: ${prodi}<br>
    PT: ${pt}
  `;
}
</script>
